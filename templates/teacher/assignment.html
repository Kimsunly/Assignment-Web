{% extends "base.html" %}

{% block title %}Assignments{% endblock %}

{% block sidebar_subtitle %}Teacher Portal{% endblock %}

{% block sidebar_menu %}
<li>
    <a href="{{ url_for('teacher_bp.dashboard') }}">
        <i class="fas fa-home"></i>
        Dashboard
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.teacher_students') }}">
        <i class="fas fa-users"></i>
        My Students
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.teacher_classes') }}">
        <i class="fas fa-chalkboard"></i>
        Classes
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.teacher_assignments') }}" class="active">
        <i class="fas fa-tasks"></i>
        Assignments
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.teacher_grades') }}">
        <i class="fas fa-chart-line"></i>
        Grades
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.teacher_profile') }}">
        <i class="fas fa-user-edit"></i>
        Edit Profile
    </a>
</li>
<li style="margin-top: 2rem;">
    <a href="{{ url_for('auth_bp.logout') }}">
        <i class="fas fa-sign-out-alt"></i>
        Logout
    </a>
</li>
{% endblock %}

{% block search_placeholder %}Search assignments...{% endblock %}

{% block user_avatar %}{{ teacher.user.username[0]|upper }}{% endblock %}
{% block user_name %}{{ teacher.user.username }}{% endblock %}
{% block user_id %}Teacher ID: {{ teacher.id }}{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h2 style="font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">
            <i class="fas fa-tasks"></i> Assignments
        </h2>
        <p style="color: #6b7280; margin: 0;">Create and manage assignments for your classes</p>
    </div>
    <button class="btn-custom btn-primary-custom" onclick="showCreateAssignmentModal()">
        <i class="fas fa-plus"></i> Create Assignment
    </button>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card primary">
        <div class="stat-icon"><i class="fas fa-tasks"></i></div>
        <div class="stat-value">{{ assignments|length }}</div>
        <div class="stat-label">Total Assignments</div>
    </div>
    <div class="stat-card warning">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div class="stat-value">{{ assignments|selectattr('status', 'equalto', 'Pending')|list|length }}</div>
        <div class="stat-label">Needs Grading</div>
    </div>
    <div class="stat-card success">
        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
        <div class="stat-value">{{ assignments|selectattr('status', 'equalto', 'Completed')|list|length }}</div>
        <div class="stat-label">Fully Graded</div>
    </div>
    <div class="stat-card info">
        <div class="stat-icon"><i class="fas fa-file-upload"></i></div>
        <div class="stat-value">{{ assignments|sum(attribute='total_submissions') }}</div>
        <div class="stat-label">Total Submissions</div>
    </div>
</div>

<!-- Filter Tabs -->
<div style="margin-bottom: 1.5rem;">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <button class="btn-custom btn-primary-custom filter-btn active" data-filter="all" onclick="filterAssignments('all')">
            All Assignments
        </button>
        <button class="btn-custom btn-outline-custom filter-btn" data-filter="pending" onclick="filterAssignments('pending')">
            Pending Grading
        </button>
        <button class="btn-custom btn-outline-custom filter-btn" data-filter="completed" onclick="filterAssignments('completed')">
            Completed
        </button>
    </div>
</div>

<!-- Assignments Table -->
<div class="content-card">
    <div class="card-header">
        <h4><i class="fas fa-list"></i> All Assignments</h4>
        <input type="text" id="searchInput" placeholder="Search assignments..." 
               style="padding: 0.625rem 1rem; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 0.9rem; max-width: 300px;">
    </div>
    
    <div class="table-responsive">
        <table class="table table-hover" id="assignmentsTable">
            <thead>
                <tr>
                    <th>Assignment Title</th>
                    <th>Class</th>
                    <th>Due Date</th>
                    <th>Submissions</th>
                    <th>Graded</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for assignment in assignments %}
                <tr data-status="{{ assignment.status|lower }}">
                    <td>
                        <strong>{{ assignment.title }}</strong>
                    </td>
                    <td>
                        <span class="badge badge-submitted">{{ assignment.class_name }}</span>
                    </td>
                    <td>{{ assignment.due_date }}</td>
                    <td>
                        <span style="font-weight: 600;">{{ assignment.total_submissions }}</span>
                    </td>
                    <td>
                        <span style="font-weight: 600; color: var(--success-color);">{{ assignment.graded }}</span>
                    </td>
                    <td>
                        {% if assignment.status == 'Completed' %}
                        <span class="badge badge-graded">{{ assignment.status }}</span>
                        {% elif assignment.status == 'Pending' %}
                        <span class="badge badge-pending">{{ assignment.status }}</span>
                        {% else %}
                        <span class="badge badge-submitted">{{ assignment.status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.25rem;">
                            <button class="btn-custom btn-outline-custom" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" 
                                    onclick="viewAssignment({{ assignment.id }})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-custom btn-outline-custom" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" 
                                    onclick="gradeAssignment({{ assignment.id }})">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <i class="fas fa-tasks"></i>
                            <h5>No assignments yet</h5>
                            <p>Create your first assignment to get started</p>
                            <button class="btn-custom btn-primary-custom" onclick="showCreateAssignmentModal()">
                                <i class="fas fa-plus"></i> Create Assignment
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .filter-btn.active {
        background: var(--primary-color) !important;
        color: white !important;
        border-color: var(--primary-color) !important;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const searchValue = this.value.toLowerCase();
        const table = document.getElementById('assignmentsTable');
        const rows = table.getElementsByTagName('tr');
        
        for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchValue) ? '' : 'none';
        }
    });
    
    // Filter functionality
    function filterAssignments(filter) {
        const rows = document.querySelectorAll('#assignmentsTable tbody tr');
        const buttons = document.querySelectorAll('.filter-btn');
        
        // Update active button
        buttons.forEach(btn => {
            btn.classList.remove('active');
            btn.classList.remove('btn-primary-custom');
            btn.classList.add('btn-outline-custom');
        });
        
        const activeBtn = document.querySelector(`[data-filter="${filter}"]`);
        if (activeBtn) {
            activeBtn.classList.add('active');
            activeBtn.classList.add('btn-primary-custom');
            activeBtn.classList.remove('btn-outline-custom');
        }
        
        // Filter rows
        rows.forEach(row => {
            if (filter === 'all') {
                row.style.display = '';
            } else {
                const status = row.getAttribute('data-status');
                row.style.display = status === filter ? '' : 'none';
            }
        });
    }
    
    function showCreateAssignmentModal() {
        alert('Create assignment modal will be implemented soon!');
    }
    
    function viewAssignment(id) {
        alert('View assignment #' + id);
    }
    
    function gradeAssignment(id) {
        alert('Grade submissions for assignment #' + id);
    }
</script>
{% endblock %}